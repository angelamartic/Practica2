---
title: "Entrega 2"
author: "Àngela Martí, Sergio Rivadulla i Jaume Maimó"
format: html
editor: visual
---

```{r, echo=FALSE, message=FALSE, warning=FALSE}

library(tidyverse)
library(ggplot2)
```

# Descripció de les dades

```{r, warning=FALSE}

#Aquí primer renombram les columnes perquè sigui més fàcil d'entendre
dades <- read.csv("Salut_Vocal_anonimizada.csv", sep = ";") 
dades <- dades %>% rename(
  p1 = La.gent.em.sent.amb.dificultat.a.causa.de.la.meva.veu,
  p2 = La.gent.no.m.entén.en.llocs.sorollosos,
  p3 = Els.meus.problemes.amb.la.veu.alteren.la.meva.vida.personal.i.social,
  p4 = Em.sent.desplaçat.de.les.converses.per.la.meva.veu,
  p5 = El.meu.problema.amb.la.veu.afecta.el.rendiment.laboral,
  p6 = Not.que.necessit.tensar.la.gola..gargamella..per.produir.la.veu,
  p7 = La.qualitat.de.la.meva.veu.és.imprevisible,
  p8 = La.meva.veu.em.molesta,
  p9 = La.meva.veu.em.fa.sentir.certa.minusvalidesa,
  p10 = La.gent.em.pregunta..què.et.passa.amb.la.veu.
  )


#Ara el que feim és canviar els caràcters pels factors corresponents. Farem els a la mateixa columna del data frame.
dades <- dades %>% mutate(
    p1 = factor(p1, 
    levels = c("Mai", "Gairebé mai", "A vegades", "Gairebé sempre", "Sempre"), 
    labels = c(0,1,2,3,4)),
    
    p2 = factor(p2, 
    levels = c("Mai", "Gairebé mai", "A vegades", "Gairebé sempre", "Sempre"), 
    labels = c(0,1,2,3,4)),
    
    p3 = factor(p3, 
    levels = c("Mai", "Gairebé mai", "A vegades", "Gairebé sempre", "Sempre"), 
    labels = c(0,1,2,3,4)),
    
    p4 = factor(p4, 
    levels = c("Mai", "Gairebé mai", "A vegades", "Gairebé sempre", "Sempre"), 
    labels = c(0,1,2,3,4)),
    
    p5 = factor(p5, 
    levels = c("Mai", "Gairebé mai", "A vegades", "Gairebé sempre", "Sempre"), 
    labels = c(0,1,2,3,4)),
    
    
    p6 = factor(p6, 
    levels = c("Mai", "Gairebé mai", "A vegades", "Gairebé sempre", "Sempre"), 
    labels = c(0,1,2,3,4)),
    
    p7 = factor(p7, 
    levels = c("Mai", "Gairebé mai", "A vegades", "Gairebé sempre", "Sempre"), 
    labels = c(0,1,2,3,4)),
    
    p8 = factor(p8, 
    levels = c("Mai", "Gairebé mai", "A vegades", "Gairebé sempre", "Sempre"), 
    labels = c(0,1,2,3,4)),
    
    p9 = factor(p9, 
    levels = c("Mai", "Gairebé mai", "A vegades", "Gairebé sempre", "Sempre"), 
    labels = c(0,1,2,3,4)),
    
    p10 = factor(p10, 
    levels = c("Mai", "Gairebé mai", "A vegades", "Gairebé sempre", "Sempre"), 
    labels = c(0,1,2,3,4)),
    
    .keep = "all", .after = Fa.alguna.de.les.activitats.següents..Es.pot.marcar.més.d.una.opció
  )

#Ara hem de passar les dades a numèric.

dades <- dades %>%
  mutate(across(29:38, as.numeric))

#Ara afegim una columna amb el sumatori

dades2 <- dades %>%
  select(-last_col())

dades2 <- dades2 %>%
  rowwise() %>%  # Para aplicar la operación fila por fila
  mutate(SumaFila = sum(c_across(29:37), na.rm = TRUE)) %>%
  ungroup()
```

# Objectius del projecte

L'objectiu principal d'aquesta enquesta és analitzar si la formació en veu que té l'enquestat influeix en la percepció de qualitat de la mateixa. En concret al nostre grup ens ha tocat treballar sobre la relació entre la veu i l'edat; intentarem respondre a la pregunta: ¿Hi ha qualque edat amb més incidències de símptomes vocals? D'aquesta manera intentarem arribar a una conclusió que ens permeti valorar si la veu es deteriora amb l'edat, o pel contrari no existeix una relació important entre ambdoós factors.

Emprarem en primer lloc les dades de la variable *edat* que ens ve donada en forma de dades ordinals. Farem un gràfic per visualitzar com es distribueixen els enquestats a les diferents categories. (Entre 20 i 35, Entre 36 i 50, Entre 51 i 65, + de 65).

També utilitzarem els resultats del test que s'ha inclòs al final de l'enquesta que ens venen donats com dades quantitatives discretes que es sitúen entre 0 i 40; on més puntuació implica que l'enquestat té una pitjor salut de la veu. Per obtenir aquestes dades substituirem les possibles respostes de cada pregunta per dades numèriques entre 1 i 4. Finalment sumarem tots els valors agrupant les dades a una columna que ens doni la puntuació final.

Per acabar creuarem l'edat amb la puntuació per concloure si existeix la relació que cercam o no.

# Anàlisis de les dades



```{r}
dades2$Quina.edat.té. <- dades$Quina.edat.té. %>% factor(levels = c("Entre 20 i 35", "Entre 36 i 50", "Entre 51 i 65", "+ de 65"))
grafic <- dades %>% ggplot(aes(x = Quina.edat.té.)) + geom_bar(color = "blue", fill = "blue") + labs(x="Edats", y="Freqüència absoluta") + ggtitle("Distribució per edats") + theme_minimal()
grafic
```
En primer lloc, llegim les dades que tenim i canviem els noms per que ens sigui més facil l'anàlisi.

```{r, warning=FALSE}
dades <- dades %>% rename(
  edat = Quina.edat.té.,
  sintomes.aquest.mes = Aquest.mes.ha.tengut.algún.símptoma.vocal.dels.següents..Es.pot.marcar.més.d.una.opció,
  baixa.veu = En.alguna.ocasió..ha.estat.de.baixa.laboral.per.problemes.de.veu.,
  problemes.veu.22.23 = Ha.tengut.problemes.de.veu.importants.i.que.li.han.dificultat.la.feina.al.llarg.del.curs.2022.2023.
 )

```



Anem a separar les variables de la variable sintomes.aquest més:

```{r}
dades$sintomes.aquest.mes <- as.character(dades$sintomes.aquest.mes)

sintomes.mes.separat <- dades %>%
  separate_rows(sintomes.aquest.mes, sep = ",\\s*")

contar_sintomes_mes <- sintomes.mes.separat %>% group_by(edat, sintomes.aquest.mes) %>%
  summarise(Conteo = n()) %>%
  ungroup()

contar_sintomes_mes
```

```{r}
library(ggplot2)
ggplot(contar_sintomes_mes, aes(x = edat, y = Conteo, fill = sintomes.aquest.mes)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Contador de Simptomes por Edat", x = "Edat", y = "Contador de Simptomes") +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))


```
Ara, anem a comparar les edats amb si s'han agafat en alguna ocasió la baixa laboral per problemes de veu:

```{r}
# Cargar los paquetes necesarios
library(dplyr)

# Supongamos que tu dataframe se llama 'encuesta'
# Reemplazamos la respuesta incorrecta en la fila 16 con una sola opción
dades <- dades %>%
  mutate(baixa.veu = ifelse(baixa.veu == "No, mai he estat de baixa per un problema de veu, Si, he tengut alguna o algunes baixes per problemes de veu", 
                       "Si, he tengut alguna o algunes baixes per problemes de veu", 
                       baixa.veu))
table(dades$baixa.veu)

# Crear tabla cruzada entre edad y baja
taula_creuada_baixa <- as.data.frame(table(dades$edat, dades$baixa.veu))
taula_creuada_baixa
```
Fem un grafic:

```{r}
# Cambiar los nombres de las columnas para mayor claridad
colnames(taula_creuada_baixa) <- c("edat", "baixa.veu", "Freq")

# Crear el gráfico
ggplot(taula_creuada_baixa, aes(x = edat, y = Freq, fill = baixa.veu)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Frecuenqüéncia de baixes per edat", 
       x = "Rang d'Edad", 
       y = "Freqüéncia", 
       fill = "Baixes per veu") +
  theme_minimal()


```


Per ùltim, anem a veure la relació entre l'edat i els problemes de veu en el any 2022_2023:
```{r}
table(dades$edat)
table(dades$problemes.veu.22.23)
# Taula creuada entre edats i problemes de veu entre el 22.23:
taula_creuada_problemes_veu <- as.data.frame(table(dades$edat, dades$problemes.veu.22.23))
taula_creuada_problemes_veu

```

Fem un grafic:

```{r}
# Cambiar los nombres de las columnas para mayor claridad
colnames(taula_creuada_problemes_veu) <- c("edat", "Problemes_veu_2223", "Freq")

# Crear el gráfico
ggplot(taula_creuada_problemes_veu, aes(x = edat, y = Freq, fill = Problemes_veu_2223)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Frecuenqüéncia de baixes per edat", 
       x = "Rang d'Edad", 
       y = "Freqüéncia", 
       fill = "Problemes veu 22.23") +
  theme_minimal()

```

```{r}
grafic2 <- dades2 %>% select(Quina.edat.té., SumaFila) %>% ggplot(aes(x = Quina.edat.té., y = SumaFila)) + geom_boxplot( color = "black") + labs(x = "Edat", y = "Puntuació") + ggtitle("Puntuació per edats") + theme_minimal()
grafic2
```

